# Unreleased

- **Variable Axis Animation**: Added play/pause button next to each variable axis slider that animates the axis in a sine wave. Animation wavelength configurable via `AXIS_ANIMATION_WAVELENGTH` setting (default: 5 seconds). Animation starts from current slider position, suppresses layer/master selection during playback, and Escape key stops all active animations. Button uses Material Symbols play_arrow/pause icons.
- **Measurement Tool Improvements**: Changed activation key from Alt to Shift (keeps delay). Added coordinate labels: y-coordinate on left edge in both modes, x-coordinate at top in editing mode (relative to glyph origin).
- **Preview and Panning on Space Key**: Instead of splitting panning to Cmd and preview to space key, both are now on space key. In text mode, preview mode kicks in after 200ms of pressing space, while shorter inserts the space character.
- **OpenType Feature Layer Data Refresh**: After applying OpenType features in editing mode, layer data is now refreshed to reflect potential glyph substitutions (e.g., ligatures, alternates), and the viewport maintains the glyph's bounding box center at the same screen position using the auto-pan system.
- **Component Counter Rendering and Hit Detection**: Components with paths in opposite directions now correctly render as open countershapes (holes) using the canvas nonzero winding rule. Both rendering and hit detection now combine all component paths (including nested components) into a single canvas path before filling/testing, allowing proper counter handling. Fixed double-click priority so component/point interactions in edit mode take precedence over glyph switching.
- **Browser Navigation Prevention**: Added protection against accidental app closure from browser back navigation shortcuts (Backspace when not in text fields, Alt+Left, Cmd+[, Cmd+Left on macOS). Also prevents accidental page reload in production (Cmd/Ctrl+R, F5) while allowing reload shortcuts in development mode.
- **Component Labels in Edit Mode**: Added hover labels for components in edit mode, similar to glyph name labels in text/preview modes. Labels display the component reference name centered below the component's bounding box, with proper handling of component transforms and nested components.
- **Canvas Plugin Architecture**: Implemented Python-based plugin system for drawing custom visualizations on the glyph canvas. Plugins are loaded as wheels via Pyodide, discovered using Python entry points (`context_canvas_plugins` group), and can draw below or above the canvas by implementing `draw_below(layer_data, glyph_name, ctx, viewport_manager)` and/or `draw_above(layer_data, glyph_name, ctx, viewport_manager)` methods. Includes complete example plugin that draws filled outlines and glyph names. See `instructions/CANVAS_PLUGINS.md` for documentation.
- **Error Display UI**: When font compilation fails (during loading or editing), the right sidebar now displays a nicely designed error message instead of the OpenType features and sliders. The error UI automatically disappears when the font compiles successfully again.
- **OpenType Parsing Refactoring**: Replaced opentype.js JavaScript library with native Rust/WASM implementation using skrifa and read-fonts from Google Fonts fontations project. Added WASM functions `get_glyph_name()`, `get_glyph_order()`, `get_font_features()`, `get_stylistic_set_names()`, and `get_font_axes()` that parse compiled fonts directly. Features UI now displays stylistic set names (ss01-ss20) from GSUB/GPOS feature parameters + name table lookups. Axes manager reads variation axes from fvar table with name table lookups for axis names. Removed opentype.js dependency and @types/opentype.js from package.json. Separated font reading code into dedicated `font_reader.rs` module and interpolation code into `interpolation.rs` module for better code organization.
- **OpenType Features Refactoring**: Migrated OpenType feature information (default-on/default-off features, descriptions) from Python (`webapp/py/opentype.py`) to JavaScript/TypeScript (`webapp/js/opentype-features.ts`). Features UI now uses native JS module instead of calling Python via Pyodide, improving performance and reducing Python dependencies.

# v0.1.2-p.5

- **Layer and master lists** Fixed appearance of layer and master list UI in editing and text mode

# v0.1.2-p.3

- **Debug Fonts** Don't emit debug fonts in production

# v0.1.2

- **Multi-Format Font Loading**: Implemented opening of `.glyphs` and `.vfj` font format via Rust/WASM using babelfont-rs library. Added `open_font_file()` WASM function that detects file format by extension, loads via babelfont convertors, and returns babelfont JSON. File browser now automatically converts non-.babelfont files transparently, enabling direct import from Glyphs sources. Opening UFO/Designspace and `.glyphspackages` will have to wait until we have native file system access.
- **Sidebearing Calculation API**: Refactored measurement tool to use new `Layer.getSidebearingsAtHeight(y?)` private method. Provides cleaner architecture where each glyph calculates its own sidebearings (left/right distances from glyph edges to outline intersections) at a given Y height, with negative values for overhangs. Measurement rendering now calls this method per-glyph instead of performing bulk intersection calculations.
- **Text Mode Master Selection**: Added master list UI in text mode sidebar with animated location transitions and auto-selection. Click a master to animate HarfBuzz rendering to that master's location over 10 frames. Slider changes automatically select/deselect masters based on location match (0.5 tolerance). Measurement tool now requires master selection and uses selected master ID to match glyph layers.
- **Layer Switch Animation Race Condition**: Fixed issue where clicking a layer in the UI and immediately trying to edit would fail with "Cannot save interpolated layer data" warning. Problem was caused by an in-flight interpolation request from the layer switch animation completing AFTER the animation finished and overwriting the restored layer data with interpolated data (`isInterpolated = true`). Now checks interpolation state before applying interpolated data to prevent stale interpolation results from overwriting valid layer data.
- **Synchronized Animation**: Fixed out-of-sync animations in editing mode between HarfBuzz glyphs and interpolated outlines. HarfBuzz glyphs now update in sync with interpolated data by waiting for async interpolation to complete and using the returned location. Text mode continues to use synchronous HarfBuzz animation for smooth, immediate response.
- **Live Interpolation Fixes**: Fixed multiple issues with live interpolation and layer switching: (1) Escape key now properly restores previous layer state with correct animation, layer data loading, and layer selection via `isLayerSwitchAnimating` flag, (2) Layer selection UI now clears immediately when dragging slider after selecting a layer, (3) Auto-panning now works correctly during slider pulls, layer switches, and escape key restoration by properly capturing and clearing auto-pan anchors.
- **Measurement Tool**: Added Alt-key measurement tool in editing mode with crosshair cursor and intersection detection. Displays white dots at outline/component intersections with distance labels. Supports both crosshair mode (horizontal/vertical lines) and click-drag mode for arbitrary line measurements. Uses `Layer.getIntersectionsOnLine()` with automatic component resolution via parent chain navigation.
- **MCP Development Server**: Added Model Context Protocol (MCP) server for AI-assisted debugging and development monitoring. Captures console logs and runtime data via WebSocket transport, exposing them through MCP resources and tools for real-time inspection during development. Includes bidirectional communication for remote control via `reload_webapp` and `execute_javascript` tools.
- **Nested Component Bugs**: Fixed multiple critical bugs in nested component editing: (1) stale interpolated transforms persisted after exiting nesting levels causing incorrect positioning - now cleared on exit, (2) stale selections when entering components - now cleared before entry, (3) stale hover states when exiting - now cleared on exit and in `clearAllSelections()`, (4) `getAccumulatedTransform()` now fetches fresh layer data after layer switches instead of using stale stack data, (5) nested component double-click now performs hit detection immediately so further nesting doesn't require mouse movement.
- **Intersection Detection**: Implemented `Layer.getIntersectionsOnLine()` for calculating line-path intersections including both curve and line segments. Includes manual line-line intersection detection (bezier-js doesn't reliably detect these).
- **Component Path Flattening**: Added `Component.getTransformedPaths()` and `Layer.getAllPaths()` public methods for recursive component flattening with transform matrices. Component method automatically determines correct master by walking parent chain to Layer.
- **Component Flattening**: Added private `Layer.flattenComponents()` method that recursively flattens all components including nested components to any depth, respecting transformation matrices. Now correctly handles multi-master fonts by using master ID to find matching component layers instead of always using layer index 0. Updated to support component lookup when `layerData` is not pre-populated. Consolidated with bounding box calculation for cleaner code. Includes comprehensive unit tests using NestedComponents font to verify correct transformation including scaling (layer 2 has Y-axis scaled dieresis component).
- **Python Object Representation**: Added `toString()` methods to all Babelfont model classes (Font, Glyph, Layer, Path, Node, Component, Anchor, Guide, Axis, Master, Instance, Shape) for readable Python `print()` output. Objects now display as `<Font "Family Name" 123 glyphs>` instead of `[object Object]`.
- **Pinch-to-Zoom**: Added trackpad pinch-to-zoom support for canvas with dedicated `ZOOM_SPEED_PINCH` setting (default: 0.01). Pinch gestures now zoom in/out at cursor position, separate from Alt+wheel behavior for better control.
- **Keyboard Shortcuts Fix**: Fixed canvas keyboard handling to allow browser shortcuts (Cmd+R, Cmd+T, Cmd+W, etc.) to work when canvas has focus. Only app-specific shortcuts are now intercepted, preventing default behavior.
- **Mouse Hit Detection**: Improved hit tolerance for components and glyphs by adding stroke-based hit testing. Components in edit mode, inactive glyphs in edit mode, and HarfBuzz-rendered glyphs in text mode now have expanded hit areas similar to nodes, making them easier to click and select.

# v0.1.1a

- **Canvas Zoom Fix**: Fixed unwanted zoom-to-fit on every node drag. Zoom now only occurs on initial font load, not on subsequent auto-recompilations.
- **Component Origin Markers**: Added `SHOW_COMPONENT_ORIGIN_MARKERS` setting (default: false) to control visibility of component origin cross markers. Includes production override to ensure markers are hidden in production.
- **Canvas UI Cleanup**: Removed crosshair (coordinate system) and baseline drawings from canvas. Pan and Zoom labels now positioned at bottom left corner.
- **Auto-Pan During Interpolation**: Added automatic panning to keep glyph bbox center stable during slider movements and layer switches. Prevents glyphs from moving out of viewport when width changes during interpolation. Fixed auto-pan not working when clicking slider at random location by moving anchor clearing from mouseup to animation complete handler.
- **Layer Selection Fix**: Fixed layer data retrieval and display by (1) normalizing Babelfont's `master` dict format to `_master` field using property existence check to handle empty string master IDs, and (2) filtering `fetchGlyphData()` to only include layers with `DefaultForMaster` (excluding `AssociatedWithMaster` layers which are intermediate/alternate designs). This resolves issues where glyphs like 'e' showed multiple duplicate "wght:400" layers instead of one layer per master, and ensures correct layer selection.
- **API Documentation Generator**: Added `downloadAPIDocs()`, `showAPIDocs()`, and `generateAPIDocs()` functions to generate comprehensive Python-oriented API documentation for the Font Object Model. Documentation is auto-generated from the JavaScript classes via Pyodide introspection with auto-generated table of contents and cross-reference links between classes. Includes offline Node.js script (`npm run generate-docs`) to generate `API.md` for inclusion in the repo.
- **Object Model Facade**: Implemented JavaScript/TypeScript object model with getters/setters over babelfontJson. Classes (Font, Glyph, Layer, Path, Node, etc.) provide OOP interface without data duplication, enabling rich methods (e.g., `path.insertNode()`) and synchronous Python access via Pyodide's JsProxy. Exposed as `window.currentFontModel`. Fixed Path.nodes getter to parse babelfont-rs compact string format into node objects. Fixed LayerDataNormalizer and OutlineEditor to share node array references instead of creating copies, ensuring modifications through object model propagate to canvas renderer. Added python-post-execution hooks to automatically re-render canvas and schedule font recompilation after Python code execution.
- **Live Component Interpolation**: Implemented recursive component interpolation in Rust WASM. Components now interpolate correctly during live slider adjustment, matching Python's recursive `fetchLayerData` behavior. Unified layer data structure between interpolated and master layers.
- **Live Interpolation**: Fixed broken glyph interpolation in editor view after PR #8 TypeScript refactor by adding missing module import to bootstrap and restoring `window.fontInterpolation` global. Fixed node destructuring bug in `LayerDataNormalizer`. Fixed wobbly layer switching animations by implementing request numbering system that discards stale out-of-order interpolation responses arriving from web worker.
- **Nested Components**: Refactored to pre-populate component `layerData` recursively for simpler, unified data structure. Bounding box calculations include nested components.
- **Auto-Zoom**: Restored auto-zoom functionality when navigating between glyphs in edit mode via keyboard (Cmd+Left/Right arrows)
- **Layer Switching**: Fixed font recompilation not triggering after switching layers via keyboard (Cmd+Up/Down). Now properly calls `autoSelectMatchingLayer()` after animation completes.
- **Hot Reload**: Fixed webpack dev server hot reload by enabling script injection. Browser now automatically reloads after TypeScript recompilation.
- **Production Settings**: Added production override system to settings framework. `SHOW_BOUNDING_BOX` now defaults to `false` in production.

# v0.1a

- **Version Management**: Automatic PWA cache versioning with update notifications
- **Update Checks**: Every 10 minutes and when window regains focus
- **Update UI**: Orange notification button with version number and release notes link in title bar
- **Release Automation**: `release.sh` script and GitHub Actions workflow for automated releases
- **Bug Fixes**: Fixed `FontDropdownManager.updateDropdown()` and service worker update notifications
- **Editor**: Completely redid canvas panning and zooming, see editor view info popup for details

# v0.0

Prehistoric, no changelog history available.
